<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ•ãƒ«ãƒã‚¤ãƒ–æ„Ÿæƒ…ä½œæ›²ã‚¢ãƒ—ãƒªï¼ˆUIå¼·åŒ–ç‰ˆï¼‰</title>
<style>
body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: sans-serif;
  transition: background 2s ease;
}
.app {
  text-align: center;
  background: rgba(0,0,0,0.3);
  padding: 40px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
  color: white;
  max-width: 900px;
}
textarea{
  width: 60%;
  min-height:150px;
  font-size:16px;
  padding:12px;
  border-radius:12px;
  border:none;
  background: rgba(255,255,255,0.2);
  color:white;
  margin-bottom:20px;
  resize:none;
}
.emotion-bars{
  display:flex;
  flex-direction:column;
  margin:10px auto 20px;
  width:60%;
}
.bar{
  display:flex;
  align-items:center;
  margin:4px 0;
}
.bar span{
  width:30px;
  text-align:center;
}
.fill{
  flex:1;
  height:16px;
  background: rgba(255,255,255,0.3);
  border-radius:8px;
  margin-left:8px;
  position:relative;
}
.fill::after{
  content:'';
  position:absolute;
  left:0; top:0;
  height:100%;
  width:0%;
  background-color:currentColor;
  border-radius:8px;
  transition: width 0.5s ease;
}
.bar.joy{ color:#ffe259; }
.bar.anger{ color:#ff4e50; }
.bar.sad{ color:#4b6cb7; }
.bar.calm{ color:#a1c4fd; }

.buttons{
  margin-top:20px;
}
button{
  font-size:18px;
  padding:12px 28px;
  margin:0 8px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  transition: transform 0.2s;
}
button:hover{ transform:scale(1.05); }

#modeToggle{
  margin-left:8px;
  background:white;
  color:#1a2a6c;
}
</style>
</head>
<body>

<div class="app">
  <h1>ğŸ¶ ãƒ•ãƒ«ãƒã‚¤ãƒ–æ„Ÿæƒ…ä½œæ›²ãƒ¡ãƒ¼ã‚«ãƒ¼</h1>
  
  <textarea id="lyrics" placeholder="æ­Œè©ã‚’å…¥åŠ›ã—ã¦ã­"></textarea>

  <div class="emotion-bars">
    <div class="bar joy"><span>å–œ</span><div class="fill" id="joy-bar"></div></div>
    <div class="bar anger"><span>æ€’</span><div class="fill" id="anger-bar"></div></div>
    <div class="bar sad"><span>å“€</span><div class="fill" id="sad-bar"></div></div>
    <div class="bar calm"><span>é™</span><div class="fill" id="calm-bar"></div></div>
  </div>

  <div class="buttons">
    <button id="compose">ğŸµ ä½œæ›²ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button id="reset">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
    <button id="modeToggle">ğŸ’¥ ã‚µãƒ“å¼·èª¿ON</button>
  </div>

  <div id="mood"></div>
</div>

<script>
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

// ã‚µãƒ“å¼·èª¿ON/OFF
let highlightEnabled = true;
document.getElementById("modeToggle").addEventListener("click",()=>{
  highlightEnabled=!highlightEnabled;
  document.getElementById("modeToggle").textContent = highlightEnabled ? "ğŸ’¥ ã‚µãƒ“å¼·èª¿ON" : "âš¡ ã‚µãƒ“å¼·èª¿OFF";
});

// æ„Ÿæƒ…èªå½™ï¼ˆå–œæ€’å“€é™Ã—5æ®µéšï¼‰
const emotionWords = {
  joy: {
    veryHigh: ["æœ€é«˜","çˆ†ç¬‘","å¤§èˆˆå¥®","è¶…æ¥½ã—ã„","ãƒãƒƒãƒ”ãƒ¼çˆ†ç™º"],
    high:     ["æ¥½ã—ã„","å¬‰ã—ã„","ãƒ¯ã‚¯ãƒ¯ã‚¯","ãƒ†ãƒ³ã‚·ãƒ§ãƒ³","å¹¸ã›"],
    medium:   ["å…ƒæ°—","æ˜ã‚‹ã„","ç¬‘é¡”","é€²ã‚€","å‰å‘ã"],
    low:      ["å°ã•ãªå–œã³","ã»ã£ã“ã‚Š","å¬‰ã—ã‚","ã«ã“ã«ã“"],
    veryLow:  ["å°‘ã—æ¥½ã—ã„","å¾®ç¬‘ã‚€","ã¾ã‚ã¾ã‚"]
  },
  anger: {
    veryHigh: ["æ¿€æ€’","æœ€æ‚ª","æ®ºæ„","æ€’ã‚Šçˆ†ç™º","è¨±ã›ãªã„"],
    high:     ["æ€’","è…¹ç«‹ã¤","ãƒ ã‚«ã¤ã","æ‚”ã—ã„","ä¸æº€"],
    medium:   ["ã‚¤ãƒ©ã‚¤ãƒ©","è‹›ç«‹ã¤","ã‚‚ã‚„ã‚‚ã‚„","ã‚„ã‚„ä¸æº€"],
    low:      ["å°‘ã—ä¸æº€","ã¡ã‚‡ã„æ€’","æ°—ã«ãªã‚‹"],
    veryLow:  ["å°‘ã—ã‚¤ãƒ©ã‚¤ãƒ©","ã‚€ã‚€ã‚€"]
  },
  sad: {
    veryHigh: ["çµ¶æœ›","æ³£ãå´©ã‚Œã‚‹","æ‚²æƒ¨","å­¤ç‹¬æ„ŸMAX","æ¶™æ­¢ã¾ã‚‰ãªã„"],
    high:     ["æ‚²ã—ã„","å¯‚ã—ã„","ã¤ã‚‰ã„","åˆ‡ãªã„","å«Œ"],
    medium:   ["è½ã¡è¾¼ã‚€","ã—ã‚‡ã‚“ã¼ã‚Š","å“€ã—ã„","å°‘ã—æ³£ã"],
    low:      ["å°‘ã—å¯‚ã—ã„","ã¡ã‚‡ã£ã¨æ‚²ã—ã„","æ²ˆã‚€"],
    veryLow:  ["ã¾ã‚ã¾ã‚æ‚²ã—ã„","å¾®å¦™ã«å¯‚ã—ã„"]
  },
  calm: {
    veryHigh: ["å¹³å’Œ","æ¥µã‚ã¦ç©ã‚„ã‹","å®‰ã‚‰ãMAX","ç‘æƒ³","é™å¯‚"],
    high:     ["é™ã‹","è½ã¡ç€ã","å®‰å¿ƒ","ã‚†ã£ãŸã‚Š","ç©ã‚„ã‹"],
    medium:   ["å°‘ã—è½ã¡ç€ã","é™ã‚","å¿ƒåœ°ã‚ˆã„"],
    low:      ["ã¡ã‚‡ã£ã¨ç©ã‚„ã‹","ã‚„ã‚„è½ã¡ç€ã"],
    veryLow:  ["å°‘ã—é™ã‹","å¾®å¦™ã«è½ã¡ç€ã"]
  }
};

// èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
const backgrounds = {
  joy: { veryHigh: "linear-gradient(135deg,#ffe259,#ffa751)", high:"linear-gradient(135deg,#fff7a1,#ffcf5b)", medium:"linear-gradient(135deg,#fef3c7,#fde68a)", low:"linear-gradient(135deg,#fff9e5,#fff2cc)", veryLow:"linear-gradient(135deg,#fffdf0,#fffaf0)" },
  anger:{ veryHigh:"linear-gradient(135deg,#ff4e50,#f9d423)", high:"linear-gradient(135deg,#ff6b6b,#ff9f43)", medium:"linear-gradient(135deg,#ff7f50,#ffa07a)", low:"linear-gradient(135deg,#ff8c69,#ffb6a0)", veryLow:"linear-gradient(135deg,#ffc0b3,#ffd9c0)" },
  sad:  { veryHigh:"linear-gradient(135deg,#232526,#414345)", high:"linear-gradient(135deg,#2c3e50,#4b6cb7)", medium:"linear-gradient(135deg,#34495e,#5d6d7e)", low:"linear-gradient(135deg,#5f6d7a,#7f8c8d)", veryLow:"linear-gradient(135deg,#95a5a6,#bdc3c7)" },
  calm: { veryHigh:"linear-gradient(135deg,#a1c4fd,#c2e9fb)", high:"linear-gradient(135deg,#b2ebf2,#80deea)", medium:"linear-gradient(135deg,#c3f0f0,#aee1e1)", low:"linear-gradient(135deg,#d0f0f5,#bce4e4)", veryLow:"linear-gradient(135deg,#e0f7fa,#d4f1f2)" }
};

// æ„Ÿæƒ…ã‚¹ã‚³ã‚¢è¨ˆç®—
function scoreEmotion(text){
  const scores={joy:0,anger:0,sad:0,calm:0};
  for(const emo in emotionWords){
    for(const level in emotionWords[emo]){
      const weight={"veryHigh":5,"high":4,"medium":3,"low":2,"veryLow":1}[level];
      emotionWords[emo][level].forEach(word=>{
        if(text.includes(word)) scores[emo]+=weight;
      });
    }
  }
  return scores;
}

// æ„Ÿæƒ…ãƒ¬ãƒ™ãƒ«åˆ¤å®š
function getEmotionLevel(scores){
  let maxEmotion="neutral", maxScore=0;
  for(const emo in scores){ if(scores[emo]>maxScore){ maxScore=scores[emo]; maxEmotion=emo; } }
  let level="medium";
  if(maxScore>=15) level="veryHigh";
  else if(maxScore>=10) level="high";
  else if(maxScore>=5) level="medium";
  else if(maxScore>=2) level="low";
  else level="veryLow";
  return {emotion:maxEmotion, level};
}

// ãƒãƒ¼æ›´æ–°
function updateBars(scores){
  const max=20; // ä»®ã®æœ€å¤§å€¤
  ["joy","anger","sad","calm"].forEach(e=>{
    const pct=Math.min(100,scores[e]/max*100);
    document.querySelector(`#${e}-bar::after`);
    const fill = document.querySelector(`#${e}-bar`);
    fill.style.setProperty("--pct", pct+"%");
    fill.querySelector("::after");
    fill.style.setProperty("--pct", pct+"%");
    fill.querySelector("::after");
  });
}

// èƒŒæ™¯å¤‰æ›´
function changeBackground(emotion, level){
  document.body.style.background = backgrounds[emotion][level];
}

// æ›²ç”Ÿæˆ
function playMusic(text, emotion, level){
  let time=audioCtx.currentTime;
  for(let i=0;i<text.length;i++){
    const osc=audioCtx.createOscillator();
    const gain=audioCtx.createGain();

    let baseFreq=220, duration=0.3;
    switch(emotion){
      case "joy": baseFreq=300; duration=0.22; if(level==="veryHigh") baseFreq=360; break;
      case "anger": baseFreq=300; duration=0.2; if(level==="veryHigh") baseFreq=400; break;
      case "sad": baseFreq=180; duration=0.45; if(level==="veryHigh") baseFreq=150; break;
      case "calm": baseFreq=220; duration=0.35; if(level==="veryHigh") baseFreq=260; break;
    }

    if(highlightEnabled && text.slice(Math.max(0,i-5),i+1).includes("ï¼")){
      baseFreq+=100;
      duration*=0.5;
    }

    const note=text.charCodeAt(i)%7;
    osc.frequency.value = baseFreq * Math.pow(2,note/7);
    gain.gain.setValueAtTime(0.12,time);

    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(time); osc.stop(time+duration);

    // èƒŒæ™¯ã‚‚å¾ã€…ã«å¤‰åŒ–
    document.body.style.background = backgrounds[emotion][level];

    time+=duration;
  }
}

// ä½œæ›²
document.getElementById("compose").addEventListener("click",()=>{
  const text=document.getElementById("lyrics").value;
  const scores=scoreEmotion(text);
  const {emotion, level}=getEmotionLevel(scores);
  document.getElementById("mood").textContent=
    emotion==="joy"?"ğŸŒˆ å–œã³ã®æ›²":
    emotion==="anger"?"ğŸ˜¡ æ€’ã‚Šã®æ›²":
    emotion==="sad"?"ğŸ˜¢ å“€ã—ã„æ›²":
    emotion==="calm"?"ğŸ˜Œ é™ã‹ãªæ›²":"ğŸ˜ æ™®é€šã®æ›²";
  changeBackground(emotion,level);
  playMusic(text,emotion,level);
});

// ãƒªã‚»ãƒƒãƒˆ
document.getElementById("reset").addEventListener("click",()=>{
  document.getElementById("lyrics").value="";
  document.getElementById("mood").textContent="";
  document.body.style.background="linear-gradient(135deg,#232526,#414345)";
});
</script>

</body>
</html>

